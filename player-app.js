import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';import { getDatabase, ref, onValue, goOnline } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js';import { firebaseConfig } from './firebase-config.js';const app=initializeApp(firebaseConfig);const db=getDatabase(app);try{goOnline(db);const b=document.getElementById('syncBadge');b.textContent='â— Live Sync';b.classList.replace('offline','online');}catch(e){}let character=null,themeMeta=null,portraitMode='street',selectedTags=new Set(),burntTags=new Set(),storyTags=[];async function loadLuxy(){const [c,t]=await Promise.all([fetch('characters/luxy-charms.json').then(r=>r.json()),fetch('themes/luxy-charms.json').then(r=>r.json())]);character=c;themeMeta=t;document.documentElement.style.setProperty('--accent',c.colorHex||t.colorHex||'#93E9BE');buildCharacterSelect();renderFolio();setPortrait('street');}function buildCharacterSelect(){const s=document.getElementById('characterSelect');s.innerHTML='<option value="luxy-charms" selected>Luxy Charms</option>';s.addEventListener('change',()=>{});}function setPortrait(m){portraitMode=m;const img=document.getElementById('portraitImg');img.src=m==='street'?themeMeta.portraits.street:themeMeta.portraits.qfactor;document.getElementById('portraitToggle').textContent=m==='street'?'Switch to Q-Factor':'Switch to Streetwear';}document.getElementById('portraitToggle').addEventListener('click',()=>setPortrait(portraitMode==='street'?'qfactor':'street'));function renderFolio(){(character.themes||[]).forEach((th,i)=>{const el=document.querySelector(`.theme-card[data-theme-index="${i}"]`);if(!el) return;const tags=(th.powerTags||[]).map(tag=>`<span class='pill' data-tag='${tag}'>${tag} <button class='tag-btn' data-burn='${tag}'>ðŸ”¥</button></span>`).join('');el.innerHTML=`<h4>${th.name}</h4><div><em>${th.type==='rainbow'?'Runway':'Identity'}:</em> ${th.runway||th.identity||''}</div><div style='margin:.3rem 0;'><strong>Weakness:</strong> ${th.weaknessTag||''}</div><div class='tags'>${tags}</div><div style='margin-top:.4rem;font-size:.9em;opacity:.8;'><strong>Theme Improvement:</strong> ${th.themeImprovement||''}</div>`;});document.querySelectorAll('[data-burn]').forEach(btn=>btn.addEventListener('click',e=>{const tag=e.currentTarget.dataset.burn;burntTags.add(tag);selectedTags.delete(tag);const pill=e.currentTarget.closest('.pill');if(pill) pill.classList.add('burnt');renderBurntList();updatePower();alert(`"${tag}" burnt!`);}));document.querySelectorAll('.pill').forEach(p=>p.addEventListener('click',()=>{const tag=p.dataset.tag;if(burntTags.has(tag)) return;if(selectedTags.has(tag)) selectedTags.delete(tag); else selectedTags.add(tag);p.classList.toggle('active');updatePower();}));updatePower();}function renderBurntList(){const b=document.getElementById('burntList');b.innerHTML=Array.from(burntTags).map(t=>`<span class='pill burnt'>${t}</span>`).join('')||'<em>No burnt tags</em>'; }document.getElementById('recoverBtn').addEventListener('click',()=>{burntTags.clear();document.querySelectorAll('.pill.burnt').forEach(p=>p.classList.remove('burnt'));renderBurntList();});document.getElementById('storyAdd').addEventListener('click',()=>{const name=document.getElementById('storyName').value.trim();const ongoing=document.getElementById('storyOngoing').checked;if(!name) return;storyTags.push({name,ongoing});document.getElementById('storyName').value='';document.getElementById('storyOngoing').checked=false;renderStoryList();updatePower();});function renderStoryList(){const box=document.getElementById('storyList');box.innerHTML=storyTags.map((t,i)=>`<span class='pill' data-story='${i}'>${t.name} ${t.ongoing?'(ongoing)':''} <button data-use-story='${i}' class='tag-btn'>+1</button> <button data-remove-story='${i}' class='tag-btn'>âœ•</button></span>`).join('');box.querySelectorAll('[data-use-story]').forEach(b=>b.addEventListener('click',e=>{const i=+e.currentTarget.dataset.useStory;storyTags[i].used=(storyTags[i].used||0)+1;if(!storyTags[i].ongoing){storyTags.splice(i,1);}renderStoryList();updatePower();}));box.querySelectorAll('[data-remove-story]').forEach(b=>b.addEventListener('click',e=>{const i=+e.currentTarget.dataset.removeStory;storyTags.splice(i,1);renderStoryList();updatePower();}));}function calcPower(){let p=selectedTags.size;p+=storyTags.reduce((a,t)=>a+(t.used?t.used:0),0);return p;}function updatePower(){document.getElementById('totalPower').textContent=calcPower();}document.getElementById('rollBtn').addEventListener('click',()=>{const d1=1+Math.floor(Math.random()*6),d2=1+Math.floor(Math.random()*6),power=calcPower(),total=d1+d2+power;const out=total>=10?'FULL SUCCESS':(total>=7?'PARTIAL SUCCESS':'MISS');document.getElementById('rollOut').innerHTML=`ðŸŽ² ${d1} + ${d2} + ${power} = <strong>${total}</strong> â€” ${out}`;storyTags.forEach(t=>{ if(!t.ongoing) t.used=0;});renderStoryList();updatePower();});onValue(ref(db,'mcBroadcast'),snap=>{const data=snap.val()||{};document.getElementById('sceneFromMC').innerHTML=data.sceneImage?`<img src='${data.sceneImage}' alt='Scene'>`:'Waiting for MC sceneâ€¦';document.getElementById('musicFromMC').textContent=data.music?`â™ª ${data.music.split('/').pop()}`:'â™ª No music playing';if(data.characterImage){document.getElementById('portraitImg').src=data.characterImage;}});loadLuxy();